- [**Řízení uživatelských účtů (UAC, User Account Control)**](#řízení-uživatelských-účtů-uac-user-account-control)
  - [**Jak UAC funguje?**](#jak-uac-funguje)
  - [**Secure Desktop**](#secure-desktop)
  - [**Zpětná kompatibilita**](#zpětná-kompatibilita)
  - [**Uživatelské účty**](#uživatelské-účty)
    - [**Účet správce (*Administrator*)**](#účet-správce-administrator)
    - [**Běžný účet (*Standart Account*)**](#běžný-účet-standart-account)
    - [**Účet Hosta (*Guest*)**](#účet-hosta-guest)
  - [**Nastavení zásad zabezpečení**](#nastavení-zásad-zabezpečení)
    - [**Možnosti:**](#možnosti)
  - [**Zásady omezení softwaru**](#zásady-omezení-softwaru)
    - [**Zásady omezení softwaru umožňují:**](#zásady-omezení-softwaru-umožňují)
    - [**Pravidlo algoritmu hash**](#pravidlo-algoritmu-hash)
    - [**Pravidlo certifikátu**](#pravidlo-certifikátu)
    - [**Pravidlo cesty**](#pravidlo-cesty)
    - [**Pravidlo zóny Internetu**](#pravidlo-zóny-internetu)
  - [**AppLocker**](#applocker)
    - [**Výchozí pravidla**](#výchozí-pravidla)
      - [**Blokující pravidla**](#blokující-pravidla)
      - [**Pravidla pro spustitelné programy**](#pravidla-pro-spustitelné-programy)
      - [**Pravidla pro instalátory**](#pravidla-pro-instalátory)
      - [**Pravidla pro skripty**](#pravidla-pro-skripty)
      - [**DLL pravidla**](#dll-pravidla)
      - [**Pravidla vydavatele (*Publisher rules*)**](#pravidla-vydavatele-publisher-rules)
      - [**Pravidlo algoritmu hash a cesty**](#pravidlo-algoritmu-hash-a-cesty)
  - [**Správa disku**](#správa-disku)
    - [**Běžné disky a svazky**](#běžné-disky-a-svazky)
    - [**Dynamické disky a svazky**](#dynamické-disky-a-svazky)
      - [**Jednoduché svazky (*Simple Volumes*)**](#jednoduché-svazky-simple-volumes)
      - [**Rozložené svazky (*Spanned Volumes*)**](#rozložené-svazky-spanned-volumes)
      - [**Prokládané svazky (RAID-0, *Striped Volumes*)**](#prokládané-svazky-raid-0-striped-volumes)
      - [**Zrcadlené disky (RAID-1, *Mirrored Volumes*)**](#zrcadlené-disky-raid-1-mirrored-volumes)
      - [**Svazky typu RAID-5**](#svazky-typu-raid-5)
  - [**Storage spaces (Prostory úložišť)**](#storage-spaces-prostory-úložišť)
- [AutomatedLab](#automatedlab)
- [**Studentské úkoly**](#studentské-úkoly)
  - [**Lab LS01 -- User Account Control**](#lab-ls01----user-account-control)
  - [**Lab LS02 -- UAC ve Windows ala Linux**](#lab-ls02----uac-ve-windows-ala-linux)
  - [**Lab LS03 -- Omezování aplikací pomocí Zásad omezení softwaru**](#lab-ls03----omezování-aplikací-pomocí-zásad-omezení-softwaru)
  - [**Lab LS04 -- Omezování aplikací pomocí nástroje AppLocker**](#lab-ls04----omezování-aplikací-pomocí-nástroje-applocker)
  - [**Lab LS05 -- Dynamické disky**](#lab-ls05----dynamické-disky)
  - [**Lab LS06 -- Rozložený svazek (Spanned Volume)**](#lab-ls06----rozložený-svazek-spanned-volume)
  - [**Lab LS08 -- Zrcadlený disk (Mirrored Volume)**](#lab-ls08----zrcadlený-disk-mirrored-volume)
  - [**Lab LS09 -- Svazek typu RAID-5 (RAID-5)**](#lab-ls09----svazek-typu-raid-5-raid-5)
  - [**Lab LS10 -- Storage spaces**](#lab-ls10----storage-spaces)
- [**Bodované úkoly**](#bodované-úkoly)


# **Řízení uživatelských účtů (UAC, User Account Control)**

UAC, neboli řízení uživatelských účtů, slouží pro rozdělení spuštěných
úloh do 2 skupin (úrovní): takové, které si vystačí s běžným
uživatelským účtem a takové, které ke svému běhu vyžadují oprávnění
správce. To umožňuje práci správce i pod běžným uživatelským účtem, a
jen v případě potřeby povýšení úlohy na správcovskou úroveň.

Tedy, jestliže máme aplikaci vyžadující správcovská práva, UAC zobrazí
výzvu k dočasnému povýšení dané úlohy do správcovské úrovně. V případě
práce pod účtem s administrátorskými právy stačí jen potvrdit tlačítko
**Pokračovat** (*Continue*). Na druhou stanu v případě přihlášení
uživatele pod standardním účtem je se zobrazí výzva k přihlášení k účtu
s administrátorskými právy.

Toto základní chování se nazývá **Režim schválení správce** (*Admin
Approval Mode*), v tomto režimu aplikace spouštěné jako správcovské
vyžadují ke svému běhu specifické povolení.

UAC je podstatným prvkem ochrany před spouštěním nevyžádaných aplikací,
jelikož většinu práce je vykonáváno v režimu běžného uživatele a
povýšení do správcovského módu vyžaduje potvrzení uživatele.

## **Jak UAC funguje?**

![](media/image1.png){width="3.182638888888889in"
height="3.1666666666666665in"}Při běžné práci např. v Microsoft Word,
nebo při změnách visuálního vzhledu se běžný uživatel nebo správce s UAC
příliš nesetká. Změna nastává v případě, kdy chcete vykonat úlohu
potřebující ke svému běhu práva správce, např. změna systémových hodin,
instalace aplikací apod. Tyto úkony Microsoft označil symbolem štítu.

Po kliknutí na symbol štítu je uživatel vyznán k potvrzení spuštění dané
úlohy v režimu správce, příp. případně pro přihlášení a získání
potřebného oprávnění ke spuštění dané úlohy. Od Windows 7 je navíc možno
ještě nastavit úroveň UAC, čímž dokážeme značně zredukovat počet hlášení
UAC.

Další vlastností UAC je zobrazení výzvy v případě spuštění např.
instalace aplikace, která není digitálně podepsána nebo ověřena, s
dotazem zda danou aplikaci chceme opravdu spustit. V případě běžného
uživatele se opět zobrazí žádost o přihlášení pod účtem s právy správce
systému.

Naopak aplikace digitálně podepsána zobrazí jen výzvu k povýšení na
úroveň správce. V případě použití běžného účtu bude opět vyžadováno
přihlášení.

## **Secure Desktop**

Při zobrazení jakékoliv výzvy UAC dojde k vytvoření snímku obrazovky a
jeho zobrazení po dobu zobrazení výzvy což znemožní jakoukoliv jinou
práci, nežli dojde k potvrzení výzvy. Stejný systém je též využit pro
úvodní nebo přihlašovací okno. Tento způsob byl zvolen za důvodu zvýšení
významu zabezpečení a také aby nedocházelo k překrytí výzvy jinými okny,
které by si pak uživatel nemusel všimnout.

## **Zpětná kompatibilita**

Ve Windows byl vytvořen systém zpětné kompatibility pro programy, které
byly naprogramovány, aby mohli zapisovat kamkoliv. Jelikož systémy
Windows od Windows Vista chrání Registry a Souborový systém, jsou pro
tyto případy důležité systémové soubory virtualizovány, což zápisy
směřované do chráněné zóny přesměruje do zóny uživatelské. Celý tento
proces je automatický a pro uživatele skrytý.

## **Uživatelské účty**

Jak již bylo řečeno podle UAC je uživatel Windows rozdělen do 2
kategorii: Běžný uživatel a správce. Kvůli zvýšení bezpečnosti ve
výchozím nastavení všichni uživatelé (kromě vestavěného administrátora)
pracují jako běžní uživatelé a jen v případě potřeby dojde k povýšení
dané úlohy do správcovského režimu.

### **Účet správce (*Administrator*)**

Správcem se stane každý uživatel, jenž je součástí skupiny
**Administrators**. Člen skupiny **Administrators** má úplný a neomezený
přístup k příslušnému počítači nebo doméně. Avšak jen Vestavěný správce
(*Build-in Administrator*) není ve výchozím nastavení podřízen UAC.

### **Běžný účet (*Standart Account*)**

Běžným účtem se myslí účet náležící do skupiny **Users** a nemůže
provádět nechtěné ani úmyslné změny systému, avšak může spouštět většinu
aplikací.

### **Účet Hosta (*Guest*)**

Je členem skupiny **Guests** a má stejná výchozí přístupová práva jako
běžný účet, ale účet Hosta (*Guest*) má více omezení a je možno na něj
aplikovat speciální zabezpečení nebo jej úplně zakázat.

## **Nastavení zásad zabezpečení**

Často bylo zmíněno, jak fungují dané vlastnosti Windows ve výchozím
nastavení a nyní se podíváme na podrobnější nastavení a jejich změny v
konzoly Editoru místních zásad zabezpečení. Tuto konzoli spustíme přes
nabídku start zapsáním **gpedit.msc**. Rozbalíme nabídku Konfigurace
počítače (*Computer Settings*) -\> Nastavení systému Windows (*Windows
Settings*) -\> Nastavení zabezpečení (*Security settings*) -\> Místní
zásady (*Local Policies*) -\> Možnosti zabezpečení (*Security Options*).

Zde se nachází následující podrobné nastavení pro UAC:

-   **Řízení uživatelských účtů: Chování výzvy ke zvýšení oprávnění pro správce v Režimu schválení správce** -- Toto nastavení zásad řídí
    chování výzvy ke zvýšení oprávnění pro správce. Oproti Windows Vista
    byla od Windows 7 tato možnost značně rozšířena a umožňuje
    podrobnější nastavení.

### **Možnosti:**

-   **Zvýšit bez zobrazení výzvy:** Umožňuje privilegovaným účtům
    provést operaci vyžadující zvýšení oprávnění bez zadání souhlasu
    nebo pověření[^1].

-   **Vyzvat k zadání pověření na zabezpečené ploše:** Pokud operace
    vyžaduje zvýšení oprávnění, zobrazí na zabezpečené ploše výzvu pro
    uživatele k zadání jména a hesla privilegovaného uživatele.
    Zadá-li uživatel platná pověření, bude operace pokračovat
    s nejvyššími oprávněními uživatele.

-   **Vyzvat k zadání souhlasu na zabezpečené ploše:** Pokud operace
    vyžaduje zvýšení oprávnění, zobrazí na zabezpečené ploše výzvu pro
    uživatele k výběru možnosti **Povolit** nebo **Zakázat**.
    Vybere-li uživatel možnost **Povolit**, bude operace pokračovat s
    nejvyššími možnými oprávněními daného uživatele.

-   **Vyzvat k zadání pověření:** Pokud operace vyžaduje zvýšení
    oprávnění, zobrazí výzvu pro uživatele k zadání uživatelského
    jména a hesla pro správu. Zadá-li uživatel platná pověření, bude
    operace pokračovat s příslušnými oprávněními.

-   **Vyzvat k zadání souhlasu:** Pokud operace vyžaduje zvýšení
    oprávnění, zobrazí výzvu pro uživatele k výběru možnosti
    **Povolit** nebo **Zakázat**. Vybere-li uživatel možnost
    **Povolit**, bude operace pokračovat s nejvyššími možnými
    oprávněními daného uživatele.

-   **Vyzvat k zadání souhlasu pro binární soubory nepocházející z Windows:** 
    (Výchozí) Pokud operace jiné aplikace než společnosti
    Microsoft vyžaduje zvýšení oprávnění, zobrazí na zabezpečené ploše
    výzvu pro uživatele k výběru možnosti Povolit nebo Zakázat.
    Vybere-li uživatel možnost Povolit, bude operace pokračovat s
    nejvyššími možnými oprávněními daného uživatele.

UAC je možno také nastavit přes Ovládací panely \\ Centrum Akcí \\
Změnit nastavení nástroje Řízení uživatelských účtů. Zde je možno
nastavit 4 úrovně UAC:

1.  **Vždy mne upozornit v těchto případech:**

    a.  Pokud se programy pokusí nainstalovat software nebo provést
          změny v počítači.

    b.  Pokud provedu změnu v nastavení Windows.

2.  **Pouze pokud se programy pokusí provést změny v počítači**
      (výchozí)

    a.  Neupozorňovat, pokud změním nastavení systému Windows.

3.  **Pouze pokud se programy pokusí provést změny v počítači (nestmívat
      plochu)**

    a.  Neupozorňovat, pokud změním nastavení systému Windows.

4.  **Nikdy mne neupozorňovat v těchto případech:**

    a.  Pokud se programy pokusí nainstalovat software nebo provést
          změny v počítači.

    b.  Pokud provedu změny v nastavení systému Windows.

-   **Řízení uživatelských účtů: Chování výzvy ke zvýšení oprávnění pro standardní uživatele** -- Tato zásada nastavuje, zda se má běžnému
    uživateli zobrazit výzva nebo zda má být automaticky *zamítnuta*.

-   **Řízení uživatelských účtů: Povolit aplikacím UIAccess zobrazit výzvu ke zvýšení oprávnění bez použití zabezpečené plochy --** Toto
    nastavení určuje, zda mohou aplikace UIAccess (*User Interface
    Accessibility* neboli UIA) automaticky zakázat u zabezpečené plochy
    výzvy ke zvýšení oprávnění používané standardním uživatelem.

-   **Řízení uživatelských účtů: Při zobrazení výzvy ke zvýšení oprávnění přepnout na zabezpečenou plochu --** toto nastavení vypne
    zabezpečenou plochu.

-   **Řízení uživatelských účtů: Režim schválení správce pro integrovaný účet správce** -- Toto nastavení určuje, zda se budou vestavěnému
    účtu správce zobrazovat výzvy UAC.

-   **Řízení uživatelských účtů: Spustit všechny správce v Režimu schválení správce** -- Toto nastavení zabezpečení určuje chování
    všech zásad UAC pro celý systém.

-   **Řízení uživatelských účtů: Virtualizovat chyby zápisu do souboru a registru do umístění jednotlivých uživatelů** -- Toto nastavení
    zabezpečení umožňuje přesměrování zastaralých chyb zápisu aplikací
    do definovaných umístění v registru i v systému souborů. Tato funkce
    zabraňuje spuštění aplikací, které byly v minulosti spuštěny v
    režimu správce a zapsaly data spuštění aplikace do adresářů
    **%ProgramFiles%**, **%Windir%**, **%Windir%\\system32** nebo
    **HKLM\\Software**.

-   **Řízení uživatelských účtů: Zjistit instalace aplikací a zobrazit výzvu ke zvýšení oprávnění** -- Toto nastavení zabezpečení určuje
    chování zjišťování instalací aplikací v celém systému, tedy zda se
    má zobrazit výzva při instalaci aplikací.

-   **Řízení uživatelských účtů: Zvýšit oprávnění pouze u aplikací UIAccess, které jsou nainstalovány v zabezpečených umístěních** --
    Toto nastavení zabezpečení vynutí požadavek, že aplikace vyžadující
    spuštění s úrovní integrity **UIAccess** (označením parametru
    **UIAccess=true** v manifestu aplikace) musí být v systému souborů
    uloženy v zabezpečeném umístění.

-   **Řízení uživatelských účtů: Zvýšit oprávnění pouze u podepsaných a ověřených spustitelných souborů** -- Toto nastavení zabezpečení
    vynutí kontrolu podpisu PKI (*Public Key Infrastructure*) u všech
    interaktivních aplikací vyžadujících zvýšení oprávnění.

## **Zásady omezení softwaru**

Zásady omezení softwaru řeší nutnost regulovat spouštění neznámého a
nedůvěryhodného softwaru. S rostoucím využitím sítí, Internetu a e-mailu
pro obchodní účely se uživatelé setkávají s novým softwarem v mnoha
různých podobách. Uživatelé se musí neustále rozhodovat, zda mohou
neznámý software spustit. Viry a trojské koně se často snaží uživatele
záměrně obelstít, aby došlo k jejich spuštění. Pro uživatele je obtížné
se správně rozhodnout, který software mohou spustit, aniž by došlo k
ohrožení zabezpečení systému.

Pomocí zásad omezení softwaru je možné identifikovat a určit software,
který je možné v počítači spustit, a ochránit tak pracovní prostředí
před nedůvěryhodným softwarem. Pro objekt zásad skupiny (GPO) je možné
definovat výchozí úroveň zabezpečení **Bez omezení** nebo
**Nepovoleno**, tak aby bylo spuštění softwaru při výchozím nastavení
povoleno nebo zakázáno. Vytvořením pravidel zásad omezení softwaru lze
pro určitý software určit výjimky z této výchozí úrovně zabezpečení.
Pokud je například výchozí úroveň zabezpečení nastavena na hodnotu
**Nepovoleno**, můžete vytvořit pravidla, která povolují spuštění
určitého softwaru. Existují tyto typy pravidel:

-   **Pravidla algoritmu hash**

-   **Pravidla certifikátu**

-   **Pravidla cesty (včetně pravidel cesty registru)**

-   **Pravidla zóny Internetu**

Zásady omezení softwaru jsou tvořeny výchozí úrovní zabezpečení a všemi
pravidly platícími pro objekt zásad skupiny. Zásady omezení softwaru se
mohou vztahovat na celou doménu, na místní počítače nebo na jednotlivé
uživatele. Zásady omezení softwaru umožňují identifikaci softwaru mnoha
způsoby. Díky infrastruktuře založené na zásadách lze rozhodnout, zda
může být identifikovaný software spuštěn. Pokud jsou používány zásady
omezení softwaru, musí uživatelé při spouštění softwarových programů
dodržovat pravidla vytvořená správci.

### **Zásady omezení softwaru umožňují:**

-   Řídit možnosti spouštění softwaru v systému. Pokud máte například
    obavy, že by uživatelé mohli přijmout pomocí e-mailu viry, můžete
    použít nastavení zásad, které nedovolí spuštění určitých typů
    souborů z adresáře příloh e-mailů používaného e-mailového programu.

-   Povolit uživatelům, kteří se střídají při práci na jednom počítači,
    spouštět pouze určité soubory. Pokud počítače používá více
    uživatelů, můžete například nastavit takové zásady omezení softwaru,
    které zajistí, aby uživatelé neměli přístup k jinému softwaru, než
    který potřebují k práci.

-   Určit, kdo může do počítače přidávat důvěryhodné vydavatele.

-   Řídit, zda se budou zásady omezení softwaru vztahovat na všechny
    uživatele nebo jen na některé uživatele počítače.

-   Zabránit spuštění jakýchkoli souborů v místním počítači, organizační
    jednotce, síti nebo doméně. Pokud je například ve vašem systému
    známý virus, můžete pomocí zásad omezení softwaru zabránit otevření
    souboru, který daný virus obsahuje.

### **Pravidlo algoritmu hash**

Hodnota hash je série bajtů s pevně definovanou délkou, která jedinečným
způsobem identifikuje softwarový program či soubor. Výpočet této hodnoty
provádí algoritmus hash. Při vytvoření pravidla algoritmu hash pro
softwarový program vypočítá modul **Zásady omezení softwaru** hodnotu
hash daného programu. Pokusí-li se uživatel spustit softwarový program,
je algoritmus hash programu porovnán s existujícími pravidly algoritmu
hash pro zásady omezení softwaru. Algoritmus hash daného softwarového
programu je vždy stejný bez ohledu na umístění programu v počítači.
Pokud je však softwarový program jakkoli pozměněn, změní se i jeho
algoritmus hash a přestane se shodovat s algoritmem hash v pravidle pro
tento algoritmus vztahujícím se k **Zásadám omezení softwaru**.

Chcete-li například zabránit uživatelům ve spuštění určitého souboru,
můžete vytvořit pravidlo algoritmu hash a nastavit úroveň zabezpečení na
hodnotu **Nepovoleno**. Soubor lze přejmenovat nebo přemístit do jiné
složky, a přesto se jeho číslo hash nezmění. Pokud se však samotný
soubor jakkoli změní, změní se i jeho algoritmus hash a může dojít k
porušení omezení.

### **Pravidlo certifikátu**

**Zásady omezení softwaru** umožňují identifikovat software také podle
jeho podpisového certifiká-tu. Můžete vytvořit pravidlo certifikátu,
které slouží k identifikaci softwaru a k povolení nebo zákazu spuštění
softwaru (v závislosti na úrovni zabezpečení). Například můžete použít
pravidla certifikátu, která umožňují automatické spuštění softwaru
pocházejícího z důvěryhodného zdroje bez zobrazení výzvy k potvrzení
této akce uživatelem. Pravidla certifikátu také můžete použít pro
spuštění souborů v zakázaných oblastech operačního systému.

Ve výchozím nastavení nejsou pravidla certifikátu povolena.

### **Pravidlo cesty**

Pravidlo cesty identifikuje software podle cesty k souboru. Pokud je
například výchozí úroveň zabezpečení počítače nastavena na hodnotu
**Nepovoleno**, můžete přesto jednotlivým uživatelům poskytnout
neomezený přístup ke konkrétním složkám. Můžete také vytvořit pravidlo
cesty tak, že použijete cestu k souboru a nastavíte úroveň zabezpečení
tohoto pravidla na hodnotu **Bez omezení**. Jako obecné cesty lze pro
tento typ pravidla použít proměnné prostředí **%userprofile%,**
**%windir%**, **%appdata%,** **%programfiles%** a **%temp%**. Kromě toho
můžete vytvářet pravidla cesty registru. U těchto pravidel je jako cesta
použit klíč registru příslušného softwaru.

Tato pravidla jsou určena cestami. Pokud se změní umístění softwarového
programu, nebude příslušné pravidlo cesty nadále funkční.

### **Pravidlo zóny Internetu**

Pravidla zón mají vliv pouze na balíčky Instalační služby systému
Windows. Pravidlo zóny může identifikovat software ze zóny, která je
zadána pomocí aplikace **Internet Explorer**. Jedná se o tyto zóny:
**internet**, **intranet**, **servery s omezeným přístupem**,
**důvěryhodné servery** a **tento počítač**.

## **AppLocker**

**AppLocker** je funkce systému představená ve Windows 7, která je
dostupná pouze v edicích **Enterprise** a **Education** (dříve i
Ultimate). Zásady jsou koncepčně podobné **Zásadám omezení softwaru**,
nicméně mají několik výhod jako možnost uplatnění pouze na vybrané
uživatele nebo skupiny a taky možnost uplatnění zásad na všechny budoucí
verze daného SW produktu. V textu výše jste se dozvěděli, že pravidla
algoritmu hash se vážou k dané verzi programu a musejí být znovu
obnovena, kdykoli se program aktualizuje. Zásady **AppLockeru** se
nachází v části **Computer Configuration \\ Windows Settings \\
Security Settings \\ Application Control Policies** zásad skupiny.

**AppLocker** závisí na službě **Application Identity Service**. Ta po
instalaci systému Windows není ve výchozím nastavení spuštěna, je
nastavena na ruční spouštění a je tedy potřeba nastavit automatické
spouštění. Jinak by nastavení, která provedete, neměla efekt. Nicméně po
dobu testování je doporučeno ponechat ruční spouštění - pokud byste
nastavili nesprávné hodnoty, mohli byste si kompletně uzamknout celý
operační systém.

### **Výchozí pravidla**

Výchozí pravidla je množina základních povolujících pravidel, která
umožňují spouštění základních aplikací Windows. Jsou velmi důležitá,
jelikož **AppLocker** má zabudované výchozí pravidlo blokovat všechny
aplikace, které nejsou explicitně povoleny, tzn. po zapnutí
**AppLockeru** nebudete schopni spouštět žádné aplikace, skripty nebo
instalátory, pro které neexistuje žádné povolovací pravidlo. Existují
různá výchozí pravidla pro různé typy pravidel. Výchozí pravidla jsou
všeobecná pro a mohou být administrátory upravena pro jejich prostředí.
Například výchozí pravidlo pro .**exe** soubory je pravidlo cesty.
Administrátoři by s ohledem na bezpečnost mohli změnit toto chování na
přísnější pravidlo, např. hash.

#### **Blokující pravidla**

Pravidla v **AppLockeru** mohou být buď povolující, nebo odepírající.
Explicitní pravidlo **Odepřít** přepíše jakékoli povolující pravidlo,
jakkoli by toto pravidlo bylo definováno. Toto je jiné chování než to u
**Zásad omezení softwaru**, kde se pravidla mohou přepisovat. Výchozí
blokující pravidlo zmíněné výše nezakazuje všechny aplikace, pouze ty,
které nemají povolující pravidlo. Musíte tedy přidat blokující pravidlo
pouze tehdy, pokud již existuje povolující pravidlo pro danou aplikaci.
Pokud byste například chtěli povolit všem uživatelům spouštět
**Alpha.exe** kromě skupiny **Účetní**, vytvořili byste dvě pravidla.
Jedno povolující skupině **Everyone** a druhé blokující pro skupinu
**Účetní**.

#### **Pravidla pro spustitelné programy**

Tato pravidla se uplatňují na soubory s koncovkami **.exe** a **.com**.
Politiky AppLockeru se primárně soustředí na tato pravidla. Výchozím
pravidlem je pravidlo cesty. Ve výchozím nastavení je možno spouštět
všechny aplikace v adresářích **Windows**, **Program Files**,
administrátoři mohou spouštět všechny programy. Je důležité použít
výchozí pravidla nebo taková pravidla, která jsou podobná, aby mohl
operační systém správně fungovat.

#### **Pravidla pro instalátory**

Tato pravidla se uplatňují na soubory s koncovkami **.msi** a **.msp**,
můžete je tedy využít pro povolení nebo zakázání instalování programů.
Ve výchozím nastavení je umožněno skupině **Everyone** spouštět
digitálně podepsané balíčky, všechny instalátory v adresáři
**%Windir%\\Installer**. Administrátoři mohou instalovat cokoli. Dále je
povolena instalace programů pomocí GPO. Mějte však na paměti, že
přestože skupina **Everyone** má možnost spouštět instalátory, přesto
potřebuje odpovídající úroveň administrativních oprávnění k provedení
instalace.

#### **Pravidla pro skripty**

Uplatňují se na soubory s koncovkami **.ps1**, **.bat**, **.cmd**,
**.vbs** a **.js**. Ve výchozím nastavení je možno spouštět všechny
skripty v adresářích **Program Files** a **%Windir%**. Dále je umožněno
administrátorům spouštět skripty uložené kdekoli.

#### **DLL pravidla**

Uplatňují se na soubory s koncovkami **.dll** a **.ocx**. Nejsou při
povolení **AppLockeru** aktivní. Jejich využíváním dochází k určitému
výkonnostnímu propadu.

#### **Pravidla vydavatele (*Publisher rules*)**

Tato pravidla fungují na základě podepisování certifikátem, který byl
použit vydavatelem souboru. Na rozdíl od pravidla certifikátu u Zásad
omezování softwaru zde nemusíte získat certifikát vydavatele, údaje
budou načteny z referenční aplikace. Toto pravidlo nemůžete použít na
soubory, které nejsou podepsány. Tato pravidla nabízejí velkou
flexibilitu do budoucna, jednou povolíte daného vydavatele a i všechny
budoucí verze programu budete moci použít. Nicméně můžete upravit
pravidlo tak, aby povolovalo pouze určitou verzi produktu nebo vybraný
produkt ne všechny produkty vydavatele.

#### **Pravidlo algoritmu hash a cesty**

Tato pravidla fungují stejně jako u **Zásad omezení softwaru**.

## **Správa disku**

### **Běžné disky a svazky**

Běžný disk je fyzický disk, který obsahuje primární oddíly, rozšířené
oddíly nebo logické jednotky. Oddíly a logické jednotky na běžných
discích se nazývají běžné svazky. Běžné svazky lze vytvářet pouze na
běžných discích.

Počet oddílů, které lze na běžných discích vytvořit, závisí na typu
oddílu na disku:

-   Na discích s hlavním spouštěcím záznamem (MBR) můžete vytvořit
    maximálně čtyři primární oddíly, nebo tři primární oddíly a jeden
    rozšířený oddíl. V rámci rozšířeného oddílu lze vytvořit neomezený
    počet logických jednotek.

-   Na discích s tabulkou oddílu GUID (GPT) můžete vytvořit až 128
    primárních oddílů. Protože disky typu GPT nejsou omezeny na čtyři
    oddíly, není třeba vytvářet rozšířené oddíly ani logické jednotky.

K existujícím primárním oddílům a logickým jednotkám lze přidat více
místa jejich rozšířením do sousedícího souvislého volného místa na
stejném disku. Chcete-li rozšířit běžný svazek, musí být tento svazek
formátován pomocí systému souborů NTFS. Logickou jednotku můžete
rozšířit v rámci souvislého volného místa v rozšířeném oddílu, jehož je
tato jednotka součástí. V případě, že logickou jednotku rozšíříte více,
než představuje volné místo v rozšířeném oddílu, zvětší se tento
rozšířený oddíl tak, aby mohl logickou jednotku obsáhnout, pokud za ním
následuje dostatek souvislého volného místa.

### **Dynamické disky a svazky**

Dynamické disky nabízejí funkce, které u běžných disků nejsou k
dispozici, například možnost vytvářet svazky uložené na více discích
(rozložené a prokládané svazky) a možnost vytvářet svazky odolné proti
chybám (zrcadlené svazky a svazky typu RAID-5). Všechny svazky na
dynamických discích se nazývají dynamické svazky. Existuje pět typů
dynamických svazků:

-   Jednoduché (*simple*)

-   Rozložené (*spanned*)

-   Prokládané (*striped*)

-   Zrcadlené (*mirrored*)

-   Svazky typu RAID-5

#### **Jednoduché svazky (*Simple Volumes*)**

Jednoduché svazky mohou obsahovat oddíly běžného disku a jednoduché
svazky dynamických svazků. Pokud nepotřebujete žádnou další
funkcionalitu z jiných typů dynamických disků, Microsoft doporučuje
používat běžné diskové oddíly.

#### **Rozložené svazky (*Spanned Volumes*)**

Rozložené svazky používají volné místo na více fyzických discích pro
vytvoření svazku. Množství volného místa pro vytvoření nemusí být na
všech discích stejné, může být libovolné a může obsahovat více než jeden
kus souvislého volného místa z jednoho fyzického disku. Rozložené svazky
zvyšují pravděpodobnost výskytu chyby a tudíž i ztráty dat. Porucha
kteréhokoli disku, který je součásti tohoto svazku, vede ke ztrátě
celého svazku. Tento typ disku nenabízí prakticky žádné výkonnostní
zlepšení, slouží hlavně pro vytvoření velkého svazku z více fyzických
disků.

#### **Prokládané svazky (RAID-0, *Striped Volumes*)**

Prokládaný svazek používá volného místa na více než jednom fyzickém
disku. Umožňuje systému zápis malých bloků dat (stripes) mezi všemi
disky, čímž distribuuje zátěž mezi disky svazku. Data jsou rozdělena do
bloků, první je zapsán na první disk, druhý blok na další atd., zápis
probíhá souběžně na všech discích. Tento typ svazku vyžaduje minimálně
dva fyzické disky.

Data jsou čtena souběžně ze všech disků svazku, čili prokládaný svazek
významně urychluje jak rychlosti čtení, tak i zápisu. Množství místa na
obou fyzických discích musí být stejné. Pokud by na jednom disku bylo
méně místa než na druhém, použije se menší množství. Svazek není odolný
vůči poruchám, pokud selže jeden z disků, přijdeme o celý svazek.

#### **Zrcadlené disky (RAID-1, *Mirrored Volumes*)**

Zrcadlené disky poskytují vyšší dostupnost a odolnost vůči poruchám, ale
teoreticky neposkytují vyšší výkonnost. K vytvoření svazku je potřeba
stejné množství místa na dvou fyzických discích. Všechny změny, které
jsou prováděny na jednom disku, jsou zrcadleny (promítány) také na druhý
disk. Pokud selže první disk, zrcadlení je porušeno a druhý z disků je
používán, dokud nedojde k opravě nebo výměně prvního disku. Zrcadlení
může být následně znovu vytvořeno a informace z jednoho disku se
duplikují na druhý. Nevýhodou je potřeba mít například dva 200 GB disky,
abyste mohli mít zrcadlený oddíl o velikosti 200 GB.

#### **Svazky typu RAID-5**

Tento typ svazků nabízí výší dostupnost, odolnost vůči poruchám a
současně vyšší výkonnost. Vyžaduje alespoň tři fyzické disky nebo stejně
velké množství volného místa na všech třech discích. Funguje podobně
jako prokládaný typ svazku, ale část kapacity slouží k uložení informace
o paritě daného bloku dat. Čili pokud jeden disk selže, data jsou
obsažena na zbylých discích, nicméně dojdu k propadu výkonnosti, jelikož
se musí data vypočítávat z partity a části fyzických dat, kdykoli se
s daty pracuje. Vadný disk může být nahrazen a obsah obnoven. Rychlost
čtení ze svazku je rychlejší, jelikož jsou data čtena ze všech disků
současně. Rychlost zápisu není tak výrazná kvůli potřebě vytvářet
paritu. Paritní informace nejsou ukládány pokaždé na stejném disku, ale
jsou distribuovány mezi všemi disky. Parita zabere stejné místo, jaké
poskytuje jeden disk, čili pokud budete mít tři disky po 200 GB, budete
mít 400 GB svazek k dispozici (n-1).

## **Storage spaces (Prostory úložišť)**

Jedná se o funkcionalitu, představenou ve Windows 8 a především ve
Windows Server 2012, která umožňuje virtualizovat diskový prostor
podobně jako je tomu u Storage Area Networks (SAN) s výrazně nižšími
náklady. Na rozdíl od výše uvedených dynamických disků však k fyzickým
diskům přistupujeme s vyšší úrovní abstrakce.

Prostor úložišť, někdy také označovaný jako Logical Unit Number (LUN),
se pro uživatele chová jako fyzický disk zpřístupňující přidělený
diskový prostor. Jednotlivé prostory úložišť jsou organizovány do tzv.
fondů (storage pool) složených z fyzických disků různých velikostí a
technologií (SATA, SAS, USB). Přidávání nových a nahrazování chybných
disků probíhá automatizovaně (a lze je ovládat z PowerShellu). Při
vytváření prostoru úložišť si můžeme zvolit úroveň odolnosti vůči
chybám.

| Odolnost                        | Jednoduchý (*simple*) | Dvoucestný zrcadlový svazek (*Two-way mirror*) | Třícestný zrcadlový svazek (*Three-way mirror*) | Parita     (*Parity*) |
| ------------------------------- | --------------------- | ---------------------------------------------- | ----------------------------------------------- | --------------------- |
| Počet kopií souboru             | 1                     | 2                                              | 3                                               |                       |
| Odolnost vůči výpadku disků     | Ne                    | 1                                              | 2                                               | 1                     |
| Minimální počet fyzických disků | 1                     | 2                                              | 5                                               | 3                     |

---

# AutomatedLab

```pwsh 
$labName = 'E05'
$adminPass = 'root4Lab'

New-LabDefinition -Name $labName -DefaultVirtualizationEngine HyperV -VmPath "E:\AutomatedLab-VMs"
Set-LabinstallationCredential -username root -password $adminPass

# Set up the defaults
# These will be used for all machines within your lab, unless you specifically overwrite them
$PSDefaultParameterValues = @{
    'Add-LabMachineDefinition:Processors' = 8
    'Add-LabMachineDefinition:Memory' = 16GB
    'Add-LabMachineDefinition:OperatingSystem' = 'Windows 11 Pro'
}

Add-LabVirtualNetworkDefinition -Name 'Default Switch' -HyperVProperties @{SwitchType = 'Internal'; AdapterName = 'Default Switch'}
Add-LabVirtualNetworkDefinition -Name 'Private1' -AddressSpace 10.1.0.0/16

$w11_1_network = @(
    New-LabNetworkAdapterDefinition -InterfaceName LAN0 -VirtualSwitch 'Default Switch' -UseDhcp 
    New-LabNetworkAdapterDefinition -InterfaceName LAN1 -VirtualSwitch Private1 -Ipv4Address 10.1.0.10/24 
)

Add-LabDiskDefinition -Name W11_DataDrive_1 -DiskSizeInGb 50
Add-LabDiskDefinition -Name W11_DataDrive_2 -DiskSizeInGb 50
Add-LabDiskDefinition -Name W11_DataDrive_3 -DiskSizeInGb 50
Add-LabDiskDefinition -Name W11_DataDrive_4 -DiskSizeInGb 50

Add-LabMachineDefinition -Name W11-1 -NetworkAdapter $w11_1_network -Disk W11_DataDrive_1,W11_DataDrive_2,W11_DataDrive_3,W11_DataDrive_4

set-labinstallationcredential -username root -password root4Lab
add-labdomaindefinition -Name testing.local -AdminUser root -AdminPassword root4Lab

$w2022_dc_network = @(
    New-LabNetworkAdapterDefinition -InterfaceName LAN0 -VirtualSwitch 'Default Switch' -UseDhcp 
    New-LabNetworkAdapterDefinition -InterfaceName LAN1 -VirtualSwitch Private1 -Ipv4Address 10.1.0.20/24 
)

Add-LabMachineDefinition -Name W2022-dc -NetworkAdapter $w2022_dc_network -OperatingSystem 'Windows Server 2022 Datacenter Evaluation (Desktop Experience)' -Roles RootDC -DomainName testing.local

$w11_domain_network = @(
    New-LabNetworkAdapterDefinition -InterfaceName LAN0 -VirtualSwitch 'Default Switch' -UseDhcp 
    New-LabNetworkAdapterDefinition -InterfaceName LAN1 -VirtualSwitch Private1 -Ipv4Address 10.1.0.21/24 
)
Add-LabMachineDefinition -Name W11-domain -NetworkAdapter $w11_domain_network -DomainName testing.local

 

Install-Lab


Invoke-LabCommand -ActivityName 'Create Group - Simpsons' -ScriptBlock {
   New-LocalGroup -Name simpsons
} -ComputerName  W11-1 

Invoke-LabCommand -ActivityName 'Create User - Homer' -ScriptBlock {
    $username = 'homer'
    $password = 'root4Lab' | ConvertTo-SecureString -AsPlainText -Force
  
    New-LocalUser -Name "$username" -Password $password -FullName "$username"
    Add-LocalGroupMember  -Member "$username" -Group users
    Add-LocalGroupMember  -Member "$username" -Group administrators 
    Add-LocalGroupMember  -Member "$username" -Group simpsons 
} -ComputerName  W11-1 
 
Invoke-LabCommand -ActivityName 'Create User - Marge' -ScriptBlock {
    $username = 'marge'
    $password = 'user4Lab' | ConvertTo-SecureString -AsPlainText -Force
  
    New-LocalUser -Name "$username" -Password $password -FullName "$username"
    Add-LocalGroupMember  -Member "$username" -Group users
    Add-LocalGroupMember  -Member "$username" -Group simpsons 
} -ComputerName  W11-1 
 
Invoke-LabCommand -ActivityName 'Create User - Lisa' -ScriptBlock {
    $username = 'lisa'
    $password = 'user4Lab' | ConvertTo-SecureString -AsPlainText -Force
  
    New-LocalUser -Name "$username" -Password $password -FullName "$username"
    Add-LocalGroupMember  -Member "$username" -Group users
    Add-LocalGroupMember  -Member "$username" -Group simpsons 
} -ComputerName  W11-1 

Invoke-LabCommand -ActivityName 'Create User - Bart' -ScriptBlock {
    $username = 'bart'
    $password = 'user4Lab' | ConvertTo-SecureString -AsPlainText -Force
  
    New-LocalUser -Name "$username" -Password $password -FullName "$username"
    Add-LocalGroupMember  -Member "$username" -Group users
    Add-LocalGroupMember  -Member "$username" -Group simpsons 
} -ComputerName  W11-1


Invoke-LabCommand -ActivityName 'Create Users' -ScriptBlock {
    $password = 'root4Lab' | ConvertTo-SecureString -AsPlainText -Force

    New-ADGroup -Name "Simpsons" -SamAccountName Simpsons -GroupCategory Security -GroupScope Global -DisplayName "Simpsons" -Description "Members of this group are Simpsons"

    New-ADUser -Name Homer  -AccountPassword $password -Enabled $true
    New-ADUser -Name Bart -AccountPassword $password -Enabled $true

    Add-ADGroupMember -Identity $Simpsons -Members Homer
    Add-ADGroupMember -Identity $Simpsons -Members Bart
} -ComputerName W2022-dc
```

Hotfix
```pwsh
Invoke-LabCommand -ActivityName 'Create Users' -ScriptBlock {
    Add-ADGroupMember -Identity Simpsons -Members Homer
    Add-ADGroupMember -Identity Simpsons -Members Bart
} -ComputerName W2022-dc
```
# **Studentské úkoly**

## **Lab LS01 -- User Account Control**

> **Cíl cvičení**
>
> Vyzkoušet si pokročilejší nastavení ovlivňující chování UAC.
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Uživatelský účet **root**, jenž je členem skupiny
> **Administrators**.
>
> Uživatelský účet **Bart**, jenž je členem skupiny **Users**.

1.  Přihlaste se k **W11-1** pod účtem **Bart**.

2.  Zkuste spustit Správu disků (Disk Management) - příkazem
      diskmgmt.msc, nebo z kontextové nabídky nad tlačítkem Start
      (Win + X)).

    -   Správa disků oznámí, že uživatel nemá odpovídající práva.

3.  Uzavřete okno Správy disků

4.  Zkuste spustit Správu disků (Disk Management), tentokrát však jako
    jiný uživatel - V nabídce Start napište **diskmgmt.msc**, klikněte
    pravým tlačítkem myši a zvolte Spustit jako správce (Run as
    Administrator)

    - Správa disků oznámí, že uživatel nemá odpovídající práva.

5. Přihlaste se jako účet **root** a heslo **root4Lab**

    -   Správa disků se otevře s vhodnými právy a tedy bez varování.

5.  Zkuste otevřít vlastnosti síťového adaptéru LAN1 (spusťte
      **ncpa.cpl** -- vybrat LAN1 a z kontextové nabídky vyberte
      Properties)

    -   Rovnou se zobrazí dialog UAC

    -   Použijte účet **root** a jeho heslo.

6.  Odhlaste se od účtu **Bart** a přihlaste se jako **root**.

7.  Otevřete Editor místních zásad skupiny (Local Group Policy Editor)
      např. příkazem **gpedit.msc**

8.  Vyberte Konfigurace počítače -\> Nastavení systému Windows -\>
      Nastavení zabezpečení -\> Lokální nastavení -\> Nastavení
      zabezpečení (Computer Configuration -\> Windows Settings -\>
      Security Settings -\> Local Policies -\> Security Options).

9.  Zakažte položku User Account Control: Switch to secure desktop when
      prompting for elevation.

10. Přihlaste zpět jako **Bart** a zkuste spustit vlastnosti síťového
      adaptéru LAN1.

11. V nabídce Start napište **gpedit.msc**, klikněte pravým tlačítkem
      myši a zvolte Spustit jako správce (Run as Administrator). Vraťte
      zpět předchozí nastavení.

12. Změňte hodnotu User Account Control: Behavior of the elevation
      prompt for standard users na **Automatically deny elevation
      requests**.

13. Stále pod účtem **Bart** zkuste otevřít vlastnosti síťového adaptéru
      LAN1.

## **Lab LS02 -- UAC ve Windows ala Linux**

> **Cíl cvičení**
>
> Nastavit UAC tak, aby se s uživatelskými účty pracovalo jako v Linuxu,
> tzn. aby správci počítače běželi vždy pod oprávněními správce a
> standardní uživatele museli zadat pověření.
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Uživatelský účet **root**, jenž je členem skupiny
> **Administrators**.
>
> Uživatelský účet **Bart**, jenž je členem skupiny **Users**.

1.  Přihlaste se k **W11-1** pod účtem **root**.

2.  Otevřete Editor místních zásad skupiny pro editaci UAC nastavení.

3.  Vyzkoušejte měnit hodnoty v položce User Account Control: Behavior
      of the elevation prompt for administrators in Admin Approval Mode
      a pro každou změnu spusťte vlastnosti síťového adaptéru LAN1
      (Pokud bychom chtěli nasimulovat UAC podobně jako v Linuxu bylo by
      třeba nastavit hodnotu na **Elevate without prompting**).

4.  Zakažte položku User Account Control: Switch to the secure desktop
      when prompting for elevation a vyzkoušejte opět spustit vlastnosti
      síťového adaptéru LAN1.

5.  Zkontrolujte hodnotu User Account Control: Behavior of the elevation
      prompt for standard users, jestli obsahuje **Prompt for
      credentials**.

6.  Přihlaste se pod uživatelem **Bart** a zkuste spustit vlastnosti
      síťového adaptéru LAN1.

## **Lab LS03 -- Omezování aplikací pomocí Zásad omezení softwaru**

> **Cíl cvičení**
>
> Zamezit spouštění konkrétní aplikace vytvořením hash pravidla zásad
> omezení softwaru.
>
> **Potřebné virtuální stroje**
>
> **W11-1**

1.  Přihlaste se na **W11-1** pod účtem **root**.

2.  Z nabídky Start spusťte **Poznámkový blok** (Notepad) a poté jej
      zavřete.

3.  Otevřete Editor místních zásad skupiny (Local Group Policy Editor)
      např. příkazem **gpedit.msc**

4.  Vyberte Konfigurace počítače -\> Nastavení systému Windows -\>
      Nastavení zabezpečení -\> Zásady omezení softwaru
      (Computer Configuration -\> Windows Settings -\> Security Settings
      -\> Software Restriction Policies), klikněte pravým tlačítkem myši
      a zvolte Nové zásady omezení softwaru (New Software Restriction
      Policies).

5.  Klikněte pravým tlačítkem myši na Další pravidla (Additional Rules)
      a zvolte Nové pravidlo algoritmu hash... (New Hash Rule...).

6.  Klikněte na tlačítko Procházet... (Browse...) a vyberte z adresáře
      **C:\\Windows** aplikaci **Notepad.exe**. Ujistěte se, že je
      zvoleno nastavení Nepovoleno (Disallowed) -\> OK.

7.  Zavřete Editor místních zásad skupiny a spusťte příkaz **gpupdate /force**. Odhlaste se a znova přihlaste a pokuste se spustit
      **Poznámkový blok**.

8.  Smažte nastavení, která jsme vytvořili v předchozích krocích,
      spusťte příkaz **gpupdate /force** a opět se odhlaste. Po
      přihlášení by mělo spuštění opět fungovat.

## **Lab LS04 -- Omezování aplikací pomocí nástroje AppLocker**

> **Cíl cvičení**
>
> Zamezit spouštění konkrétní aplikace vytvořením pravidla vydavatele
> nástroje AppLocker.
>
> **Poznámka:**
>
> **Potřebné virtuální stroje**
>
> **W11-domain\
> w2022-dc**

1.  Přihlaste se na **W2022-dc** pod účtem **testing\\administrator**.

2.  Otevřete Správu zásad skupin (Group Policy Management)

    -   Start → Windows Administrative Tools → **Group Policy Management** nebo příkazem **gpmc.msc**

-   Jedná se obdobu nástroje Editor místních zásad skupiny (Local Group
    Policy Editor, gpedit.msc) pro centrální konfiguraci počítačů v
    doméně.

3.  Vytvořte objekt zásady skupiny (GPO) **Applocker policy**

    -   Klikněte pravým na doménu **testing.local** a zvolte Create a
        GPO in this domain, and Link it here...

    -   Jako název (Name) zvolte **Applocker policy** a u Source Starter
        GPO ponechte (**none**)

    -   Potvrďte OK

4.  Z kontextové nabídky (pravý klik) objektu **Applocker policy**
    zvolte Upravit (Edit). Objeví se okno Editor správy zásad skupiny
    (Group Policy Management Editor)

5.  Vyberte Konfigurace počítače -\> Zásady -\>
    Nastavení systému Windows -\> Nastavení zabezpečení -\>
    Zásady omezení softwaru -\> AppLocker (Computer Configuration -\>
    Policies -\> Windows Settings -\> Security Settings -\> Application
    Control Policies -\> AppLocker).

6.  Klikněte pravým tlačítkem myši na Pravidla spouštění (Executable
    Rules) a vyberte Vytvořit nové pravidlo (Create New Rule).
    V průvodci si přečtěte úvodní informace a pokračujte.

7.  Na stránce Oprávnění (Permissions) vyberte **Odepřít** (Deny) a
    pokračujte pomocí Další (Next).

8.  Na stránce Podmínky (Conditions) vyberte **Vydavatel** (Publisher) a
    pokračujte pomocí Další (Next).

9.  Na stránce Vydavatel klikněte na tlačítko Procházet (Browse) a
    vyberte z adresáře **C:\\Windows** aplikaci **Notepad.exe**.

    -   Nyní můžete zvolit, které z údajů ze zvolené aplikace se použijí
        jako pravidlo

        i.  Při zaškrtnutí Zvolit vlastní hodnoty (Use custom values)
            lze jednotlivé hodnoty editovat - všimněte si změn u verze
            souboru (File version)

10. Nastavte posuvník definice pravidla na úroveň Název souboru (File
    name) a pokračujte pomocí Další (Next).

11. Na stránce Výjimky (Exceptions) můžete obdobným způsobem nadefinovat
    výjimky z nastavovaného pravidla. Pokračujte pomocí Další (Next).

12. Na stránce Name (Název) pojmenujte pravidlo (můžete ponechat výchozí
    název) a pokračujte Vytvořit (Create)

    -   Při dotazu na Vytvoření výchozích pravidel zvolte **Ano** (Yes).

13. Zvolte uzel **Applocker** a z kontextové nabídky (pravý klik) zvolte
    Vlastnosti (Properties). Vyberte kartu Vynucení (Enforcement)

14. U pravidel vydavatele (Executable rules) zaškrtněte Nakonfigurováno
    (Configured). Z nabídky vyberte Pouze audit (Audit only). Potvrďte
    tlačítkem Použít (Apply)

15. Nyní nastavím spouštění služby Identita aplikací (Application
    identity)

16. V Editoru správy zásad skupiny objektu **Applocker policy** (Group
    Policy Management Editor) vyberte Konfigurace počítače -\> Zásady
    -\> Nastavení systému Windows -\> Nastavení zabezpečení -\>
    Systémové služby (Computer Configuration -\> Policies -\>
    Windows Settings -\> Security Settings -\> System Services).

17. Mezi službami najděte službu Identita aplikace (Application
    Identity), z kontextové nabídky vyberte Vlastnosti (Properties),
    zaškrtněte Nastavit tuto zásadu (Define this policy settings)
    a vyberte Automaticky (Automatic). Potvrďte tlačítkem OK.

18. Zavřete Editor správy zásad skupiny (Group Policy Management Editor)

19. Přihlaste se na **W11-domain** pod účtem **testing\\Bart**.

20. Pokuste se spustit **Poznámkový blok** (notepad.exe).

21. Spusťte příkaz **gpupdate /force**.

22. Otevřete MMC konzolu Služby (Services) např. příkazem
      **services.msc**.

23. Vyhledejte službu Identita aplikace (Application Identity) a
      zkontrolujte její stav

24. Pokuste se spustit **Poznámkový blok** (notepad.exe).

    -   Povede se, protože jsme nastavili pouze audit.

25. Otevřete Prohlížeč událostí (Event Viewer) např. příkazem
      **eventvwr.msc**.

26. Přejděte do Protokoly aplikací a služeb -\> Microsoft -\> Windows
      -\> Applocker (Applications and Services Log -\> Microsoft -\>
      Windows -\> Applocker) a prozkoumejte log **Exe and DLL**

    -   Naleznete zde Varování (Warning) o spuštění aplikace
        notepad.exe.

27. Přihlaste se na **W2022-dc** pod účtem **testing\\administrator**.

28. Upravte zásadu **Applocker policy** a přepněte **Applocker** do
      režimu vynucení pravidel (Enforce rules)

    -   Zopakujte body 2, 4, 5, 13, 14, 18

29. Přihlaste se na **W11-domain** pod účtem **testing\\Bart**.

30. Pokuste se spustit **Poznámkový blok** (notepad.exe).

    -   Nepovede se, protože jsme nastavili vynucení.

31. Zkontrolujte protokol událostí

    -   Zopakujte body 25, 26

## **Lab LS05 -- Dynamické disky**

> **Cíl cvičení**
>
> Vyzkoušet si základní práci s diskovými oddíly a dynamickými disky.
> Převést disk na dynamický disk a vytvořit na něm jednoduchý svazek.
>
> **Potřebné virtuální stroje**
>
> **W11-1**

1.  Přihlaste se na **W11-1** účtem **root**.

2.  Otevřete konzoli Správa disků (Disk Management) např. příkazem
      **diskmgmt.msc**.

3.  Pokud jsou nově připojené disky Offline, klikněte na ně a
      z kontextové nabídky vyberte Online.

4.  Z kontextové nabídky nově přidaných disků zvolte Inicializace disků
      (Initialize Disk) a proveďte inicializaci všech disků jako
      **MBR**.

5.  Konvertujte disky 1 a 2 na dynamické. Klikněte pravým tlačítkem myši
      na příslušný disk a zvolte nabídku Převést na dynamický disk...
      (Convert to Dynamic Disk...).

6.  Spusťte příkazový řádek **cmd**. Konvertujte třetí disk na dynamický
      pomocí nástroje **Diskpart**:

    a.  **diskpart**

    b.  **list disk**

    c.  **select disk 3**

    d.  **clean**

    e.  **convert dynamic**

    f.  **exit**

7.  Vraťte se zpět do konzole Disk Management. Klikněte pravým tlačítkem
      myši na volné místo disku 1 a vyberte Nový jednoduchý svazek...
      (New Simple Volume...). Pomocí průvodce vytvořte oddíl:

    -   Velikost: **20480 MB (20GB)**

    -   Jednotka: **P**

    -   Systém souborů: **NTFS**

    -   Rychlé formátování

8.  Vraťte se do **příkazového řádku**. Vytvoříme podobný svazek
      s využitím nástroje **diskpart**:

    a.  **diskpart**

    b.  **select disk 2**

    c.  **create volume simple size=20480**

    d.  **list volume**

    e.  **select volume *\<číslo-oddílu\>***

    f.  **format FS=NTFS quick**

    g.  **assign letter=Q**

    h.  **exit**

9.  Vraťte se zpět do konzole Disk Management a vytvořené svazky
    odstraňte.

## **Lab LS06 -- Rozložený svazek (Spanned Volume)**

> **Cíl cvičení**
>
> Vytvořit oddíl, jenž bude rozprostřen přes tři fyzické disky, tzn.
> rozložený svazek tvořený třemi oddíly, kdy každý z těchto oddílů bude
> ležet na jiném fyzickém disku, ale dohromady budou tvořit jediný
> svazek o velikosti dané součtem všech tří použitých oddílů.
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Splnění LS00.

1.  Přihlaste se na **W11-1** účtem **root**..

2.  Otevřete konzolu Správa disků (Disk Management) např. příkazem
      **diskmgmt.msc**.

3.  Klikněte pravým tlačítkem na **Disk1** a vyberte Nový rozložený
      svazek... (New Spanned Volume...).

4.  V průvodci na stránce Vyberte jednotky (Select Disks) přidejte
      všechny tři disky a u každého disku zvolte jinou velikost, kterou
      přispěje daný disk k novému svazku např. 10000 MB, 20000 MB,
      30000 MB. Pokračujte dále a připojte nový svazek pod dalším
      dostupným písmenem a (rychle) naformátujte na NTFS. Pokud není
      některý vybraný disk označen jako dynamický, bude zobrazeno
      varování, že dojde ke konverzi.

5.  Klikněte pravým tlačítkem myši na **Disk3** a vyberte Offline.
      Všimněte si, že přijdeme o celý svazek.

6.  Uveďte **Disk3** do stavu Online.

7.  Vraťte se zpět do konzole Disk Management a vytvořené svazky
      odstraňte.

**Lab LS07 -- Prokládaný svazek (Stripped Volume)**

> **Cíl cvičení**
>
> Vytvořit oddíl, který bude představovat softwarový RAID-0, tzn.
> polovina dat bude uložena na jednom oddílu a druhá půlka na jiném. Oba
> použité oddíly musí být stejné velikosti a výsledná velikost
> vytvořeného svazku bude dána součtem velikostí obou oddílů.
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Splnění LS00.

1.  Přihlaste se na **W11-1** účtem **root**.

2.  Otevřete konzolu Správa disků (Disk Management) např. příkazem
      **diskmgmt.msc**.

3.  Klikněte pravým tlačítkem na **Disk1** a vyberte Nový prokládaný
      svazek... (New Stripped Volume...).

4.  V průvodci na stránce Vyberte jednotky (Select Disks) přidejte
      **Disk1** a **Disk2** a nastavte velikost odebraného místa
      z každého disku na 10240 MB (10 GB). Dokončete průvodce.

5.  Nasimulujte výpadek disku 2, dojde tak ke ztrátě dat na obou
      discích.

6.  Uveďte **Disk2** do stavu Online.

7.  Konvertujte **Disk3** na dynamický pomocí nástroje **diskpart** (viz
      LS01 -- bod 6)

8.  Spusťte **příkazový řádek**. Vytvoříme podobný svazek s využitím
      nástroje **diskpart**:

    a.  **diskpart**

    b.  **create volume stripe size=10240 Disk=2,3**

    c.  **list volume**

    d.  **select volume *\<číslo-oddílu\>***

    e.  **format FS=NTFS Quick**

    f.  **assign letter=*\<písmeno-jednotky\>***

    g.  **exit**

9.  Vraťte se zpět do konzole Disk Management a vytvořené svazky
    odstraňte.

## **Lab LS08 -- Zrcadlený disk (Mirrored Volume)**

> **Cíl cvičení**
>
> Vytvořit oddíl, který bude představovat softwarový RAID-1, tzn. data
> budou uložena na dvou discích (oddílech) zároveň. Oba použité oddíly
> musí být stejné velikosti a výsledná velikost vytvořeného svazku bude
> dána velikostí jednoho z oddílů (druhý bude obsahovat kopii dat).
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Splnění LS00.

1.  Přihlaste se na **W11-1** účtem **root**.

2.  Otevřete konzolu Správa disků (Disk Management) např. příkazem
      **diskmgmt.msc**.

3.  Klikněte pravým tlačítkem na **Disk1** a vyberte Nový zrcadlený
      svazek... (New Mirrored Volume...).

4.  V průvodci na stránce Vyberte jednotky (Select Disks) přidejte
      **Disk1** a **Disk2** a nastavte velikost odebraného místa
      z každého disku na 5120 MB (5 GB). Dokončete průvodce.

5.  Zkopírujte na nový svazek libovolná data.

6.  Opět nasimulujte výpadek, tentokrát disku 1.

7.  Zkopírujte další data na svazek.

8.  Uveďte **Disk1** do stavu Online. Všimněte si, že svazek hlásí chybu
      redundance (synchronizace). Klikněte na daný oddíl pravým
      tlačítkem myši a zvolte Aktivovat svazek (Reactivate Volume).

    a.  V případě, kdy **Disk1** je chybně rozpoznán a označen jako Cizí
        (Foreign) může skončit s chybou *The plex is missing.* Typicky v
        případě disků připojených jako SCSI. V takovém případě musíme
        ukončit zrcadlení, disk 1 smazat a následně jej znovu přidat.

        i.  Uveďte **Disk1** do stavu Offline.

        ii. Vyberte **Disk2** a z kontextové nabídky zvolte Odstranit
            zrcadlený svazek (Remove Mirror).

        iii. V dialogu označte **Missing**, pokračujte Odstranit svazek
             (Remove Mirror) a dotaz potvrďte Ano (Yes).

        iv. Uveďte **Disk1** do stavu Online.

        v.  Pomocí nástroje **diskpart** smažte obsah **disku 1**

            1.  **diskpart**

            2.  **select disk 1**

            3.  **clean**

            4.  **exit**

        vi. V konzoli Disk Management nainicializujte **Disk 1** na MBR
            (viz LS01 -- bod 4).

        vii. Vyberte svazek na Disku 2 a z kontextové nabídky zvolte
             Přidat zrcadlení... (Add Mirror...).

        viii. V nabídce vyberte **Disk 1** a pokračujte tlačítkem Add
              Mirror.

        ix. Dojde k synchronizaci dat z **Disku 2** na **Disk 1**.

9.  Konvertujte **Disk3** na dynamický pomocí nástroje **diskpart** (viz
    LS01 -- bod 6)

10. Spusťte příkazový řádek. Vytvoříme podobný disk s využitím nástroje
      **diskpart**:

    a.  **diskpart**

    b.  **create volume mirror size=10240 Disk=2,3**

    c.  **list volume**

    d.  **select volume *\<číslo-oddílu\>***

    e.  **format FS=NTFS quick**

    f.  **assign letter=*\<písmeno-jednotky\>***

    g.  **exit**

11. Vraťte se zpět do konzole Disk Management a vytvořené svazky
    odstraňte.

## **Lab LS09 -- Svazek typu RAID-5 (RAID-5)**

> **Cíl cvičení**
>
> Vytvořit oddíl, který bude představovat softwarový RAID-5. Vytvořený
> svazek se bude skládat ze tří oddílů, kde všechny oddíly musí být
> stejné velikosti a výsledná velikost svazku bude dána součtem
> velikostí dvou použitých oddílů (zbylé místo bude sloužit k uložení
> parity).
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Splnění LS00.

1.  Přihlaste se na **W11-1** účtem **root**.

2.  Otevřete konzolu Správa disků (Disk Management) např. příkazem
      **diskmgmt.msc**.

3.  Vytvořte si na disku **C** adresář **C:\\RAID5**.

4.  Klikněte pravým tlačítkem na **Disk 1** a vyberte Nový svazek typu
      RAID-5... (New RAID-5 Volume...).

5.  V průvodci přidejte **Disk 2** a **Disk 3** a zvolte velikost 5120
      MB (5 GB) -\> Next. Na další stránce nepřidávejte oddílu další
      písmeno jednotky, ale Připojit do této prázdné složky NTFS: (Mount
      in the following empty NTFS folder:) a kliknutím na tlačítko
      Procházet... (Browse...) vyberte adresář **C:\\RAID5**. Dokončete
      průvodce.

6.  Zkopírujte na nový svazek libovolná data.

7.  Klikněte pravým tlačítkem myši na oddíl **C** a zvolte Zmenšit
      svazek... (Shrink Volume...). Uvolněte si 10 GB (10240 MB) místa.

8.  Konvertujte **Disk 0** na dynamický disk.

9.  Nasimulujte výpadek třetího disku. Oddíl bude stále dostupný.
      Klikněte na něj pravým tlačítkem myši a zvolte Opravit svazek...
      (Repair Volume...) a následně zvolte **Disk 0**.

10. Uveďte **Disk 3** do stavu Online. Všiměte si, že již není součástí
      svazku.

11. Vytvořený svazek odstraňte.

## **Lab LS10 -- Storage spaces**

> **Cíl cvičení**
>
> Vyzkoušet si základní práci s prostory úložišť.
>
> **Potřebné virtuální stroje**
>
> **W11-1**
>
> **Další prerekvizity**
>
> Splnění LS00.

1.  Přihlaste se na **W11-1** účtem **.\\student**.

2.  Otevřete Ovládací panely \\ Systém a zabezpečení \\ Prostory úložišť
      (Control Panel \\ System and Security \\ Storage Spaces).

> Alternativně: Nastavení \\ Systém \\ Úložiště \\ Spravovat prostory
> úložiště (Settings \\ System \\ Storage \\ Manage Storage Spaces)

3.  Klikněte na Vytvořit nový fond a prostor úložiště (Create a new pool
      and storage space).

4.  Vyberte všechny přidané disky a pokračujte tlačítkem Vytvořit fond
      (Create pool).

5.  Pojmenujte jednotku, zvolte písmeno a vyzkoušejte si změny typu
    odolnosti (resiliency). Všímejte si změn v části velikost.

6.  Zvolte typ odolnosti Dvoucestný zrcadlový svazek (Two-way mirror) a
    vytvořte prostor úložiště.

7.  Otevřete konzolu Správa disků (Disk Management), např. příkazem
      **diskmgmt.msc**, a prohlédněte si změny.

8.  Ve  správci hyper-v v nastavení stanice **W11-1** odeberte jeden
      z dříve přidaných disků.

> Pozn. Používáme disky připojené pomocí sběrnice SCSI, která podporuje
> Hot Plug. V případě připojení přes sběrnici IDE nebo sběrnici SATA v
> režimu IDE (nebo SATA kdy chipset nedisponuje úplnou podporou
> nativního režimu AHCI) je nutné před připojením/odpojením disku
> počítač vypnout a následně zapnout.

9.  Otevřete Ovládací panely \\ Systém a zabezpečení \\ Prostory úložišť
      (Control Panel \\ System and Security \\ Storage Spaces) a
      zkontrolujte stav. (pozn. upozornění se zobrazí i v centru akcí)

10. Ve  správci hyper-v v nastavení stanice **W11-1** připojte
      poslední prázdný virtuální disk ze složky **I:\\jine** (viz LS00).

11. Otevřete Ovládací panely \\ Systém a zabezpečení \\ Prostory úložišť
      (Control Panel \\ System and Security \\ Storage Spaces).

12. Zvolte Změnit nastavení (Change settings)

13. Přidejte do fondu nově připojený disk (Add Drives).

14. Odeberte fyzickou jednotku, kterou jste dříve odpojili (Remove
      Drive).

# **Bodované úkoly**

**Úkol 1**

-   Stáhněte aplikaci [**Process
      Explorer**](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)
      (najdete na \\\\file.nepal.local\\data\\kurzy pro FIT
      a FEKT\\ProcessExplorer). Zajistěte, aby ji mohl spouštět pouze
      **Bart** a to jakoukoli verzi i po aktualizaci programu bez zásahu
      administrátora.

<!-- 
**Řešení**

-   Vytvořit pravidlo vydavatele nástroje **AppLocker**, jenž bude
      blokovat spouštění jakékoliv ver-ze aplikace **Process Explorer**
      pro všechny uživatele s výjimkou uživatele **Bart**.
-   Ověřit, že je vytvořeno výše uvedené pravidlo. -->

[^1]: Tuto možnost použijte pouze ve velmi omezených prostředích.
